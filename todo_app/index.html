<!DOCTYPE html>
<html>
<head>
  <title>Todo App</title>
</head>
<body>

<h1>Hello from todo-app!</h1>

<img src="/image" alt="Random Image" style="max-width: 600px; height: auto;"><br><br>

<input type="text" id="todoInput" maxlength="140">
<button onclick="createTodo()">Create Todo</button>

<h2>Todo</h2>
<ul id="todoList"></ul>

<h2>Done</h2>
<ul id="doneList"></ul>

<script>
  async function fetchTodos() {
    const res = await fetch('/api/todos');
    const todos = await res.json();

    const todoList = document.getElementById('todoList');
    const doneList = document.getElementById('doneList');

    todoList.innerHTML = '';
    doneList.innerHTML = '';

    todos.forEach(todo => {
      const li = document.createElement('li');
      li.textContent = todo.text;

      if (!todo.done) {
        const btn = document.createElement('button');
        btn.textContent = 'Done';
        btn.style.marginLeft = '10px';
        btn.onclick = () => markDone(todo.id);
        li.appendChild(btn);
        todoList.appendChild(li);
      } else {
        doneList.appendChild(li);
      }
    });
  }

  async function createTodo() {
    const input = document.getElementById('todoInput');
    const todo = input.value.trim();
    if (!todo) return;

    await fetch('/api/todos', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ todo })
    });

    input.value = '';
    fetchTodos();
  }

  async function markDone(id) {
    await fetch(`/api/todos/${id}/done`, {
      method: 'POST'
    });
    fetchTodos();
  }

  fetchTodos();
</script>

</body>
</html>
